<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neverfull MM Damier Ebene - Louis Vuitton | SERIAE</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;500;600;700&family=Inter:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <script src="../assets/js/translations.js"></script>
</head>
<body>
    <a href="#main-content" class="skip-to-content" data-translate="accessibility.skip">Skip to content</a>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="../index.html"><h1>SERIAE</h1></a>
            </div>
            <div class="nav-links">
                <div class="nav-dropdown">
                    <a href="../dashboard.html" class="nav-link" data-translate="nav.dashboard">Dashboard</a>
                </div>
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-trigger"><span data-translate="nav.buyer.menu">Buyer Menu</span> <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu">
                        <a href="../collections/index.html" class="dropdown-item" data-translate="buyer.browse.collections">Browse Collections</a>
                        <a href="../auctions/index.html" class="dropdown-item" data-translate="buyer.active.auctions">Active Auctions</a>
                        <a href="../auctions/history.html" class="dropdown-item" data-translate="buyer.bidding.history">Bidding History</a>
                        <a href="../watchlist/index.html" class="dropdown-item" data-translate="buyer.watchlist">Watchlist</a>
                        <a href="../purchases/index.html" class="dropdown-item" data-translate="buyer.purchase.history">Purchase History</a>
                    </div>
                </div>
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-trigger"><span data-translate="nav.seller.menu">Seller Menu</span> <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu">
                        <a href="../seller/register.html" class="dropdown-item" data-translate="seller.product.registration">Product Registration</a>
                        <a href="../seller/products.html" class="dropdown-item" data-translate="seller.product.list">Product List</a>
                        <a href="../seller/exhibitions.html" class="dropdown-item" data-translate="seller.exhibition.list">Exhibition List</a>
                        <a href="../seller/analytics.html" class="dropdown-item" data-translate="seller.sales.analytics">Sales Analytics</a>
                        <a href="../seller/consignment.html" class="dropdown-item" data-translate="seller.consignment.status">Consignment Status</a>
                    </div>
                </div>
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-trigger"><span data-translate="nav.user.management">User Management</span> <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu">
                        <a href="../legal/terms.html" class="dropdown-item" data-translate="user.terms.of.use">Terms of Use</a>
                        <a href="../support/contact.html" class="dropdown-item" data-translate="user.contact.us">Contact Us</a>
                        <a href="../support/index.html" class="dropdown-item" data-translate="user.support.center">Support Center</a>
                        <a href="../legal/privacy.html" class="dropdown-item" data-translate="user.privacy.policy">Privacy Policy</a>
                    </div>
                </div>
            </div>
            <div class="nav-actions">
                <div class="nav-dropdown language-toggle">
                    <a href="#" class="nav-link dropdown-trigger">EN <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item" data-lang="en" data-translate="common.english">English</a>
                        <a href="#" class="dropdown-item" data-lang="ja" data-translate="common.japanese">日本語</a>
                    </div>
                </div>
                <div class="nav-dropdown profile-menu">
                    <a href="#" class="nav-link dropdown-trigger profile-trigger"><span data-translate="nav.profile">Profile</span> <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu profile-dropdown">
                        <div class="profile-header">
                            <div class="profile-avatar">S</div>
                            <div class="profile-info">
                                <span class="profile-name" data-translate="profile.member.name">Seriae Member</span>
                                <span class="profile-status" data-translate="profile.member.status">Premium</span>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="../account/profile.html" class="dropdown-item" data-translate="profile.my.profile">My Profile</a>
                        <a href="../account/settings.html" class="dropdown-item" data-translate="profile.account.settings">Account Settings</a>
                        <a href="../account/addresses.html" class="dropdown-item" data-translate="profile.shipping.address">Shipping Address</a>
                        <a href="../account/payment.html" class="dropdown-item" data-translate="profile.bank.accounts">Bank Accounts</a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item logout" data-translate="nav.logout">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main id="main-content">
        <section class="item-detail">
            <div class="container">
                <nav class="breadcrumb" aria-label="Breadcrumb">
                    <a href="../index.html">Home</a> /
                    <a href="../collections/index.html">Collections</a> /
                    <span id="breadcrumb-item">Loading...</span>
                </nav>

                <div id="item-content" class="item-layout">
                    <!-- Content will be rendered by JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>SERIAE</h3>
                <p data-translate="footer.tagline">Curating excellence in luxury resale since 1987</p>
            </div>
            <div class="footer-section">
                <h4 data-translate="footer.collections">Collections</h4>
                <ul>
                    <li><a href="../collections/index.html" data-translate="footer.handbags.accessories">Handbags & Accessories</a></li>
                    <li><a href="../collections/index.html" data-translate="footer.fine.timepieces">Fine Timepieces</a></li>
                    <li><a href="../seller/register.html" data-translate="footer.private.consignment">Private Consignment</a></li>
                    <li><a href="../support/index.html" data-translate="footer.authentication.services">Authentication Services</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4 data-translate="footer.experience">Experience</h4>
                <ul>
                    <li><a href="../support/index.html" data-translate="footer.private.showroom">Private Showroom</a></li>
                    <li><a href="../support/contact.html" data-translate="footer.personal.curator">Personal Curator</a></li>
                    <li><a href="../account/profile.html" data-translate="footer.member.services">Member Services</a></li>
                    <li><a href="../support/index.html" data-translate="footer.heritage.stories">Heritage Stories</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p data-translate="footer.copyright">&copy; 2024 Seriae. All rights reserved. | London | New York | Geneva</p>
        </div>
    </footer>

    <script src="../assets/js/data.js"></script>
    <script src="../assets/js/ui.js"></script>
    <script src="../assets/js/render.js"></script>
    <script src="../assets/js/forms.js"></script>
    <script src="../assets/js/main.js"></script>
    <script>
        // Item detail page logic
        (async function() {
            // Get slug from URL
            const slug = window.location.pathname.split('/').pop().replace('.html', '');
            const items = await window.DataService.getItems();
            const item = items.find(i => i.slug === slug);

            if (!item) {
                document.getElementById('item-content').innerHTML = `
                    <div class="error-state">
                        <h2>Item Not Found</h2>
                        <p>The item you're looking for doesn't exist.</p>
                        <a href="../collections/index.html" class="btn-primary">Browse Collections</a>
                    </div>
                `;
                return;
            }

            // Update page title and breadcrumb
            document.title = `${item.title} - ${item.brand} | SERIAE`;
            document.getElementById('breadcrumb-item').textContent = item.title;

            const watchlist = window.DataService.getWatchlist();
            const isWatched = watchlist.includes(item.id);
            const auctionData = await window.DataService.getAuctions();

            // Get highest bid for auction items
            let currentBid = item.price;
            if (item.status === 'auction') {
                const bids = auctionData.bids.filter(b => b.itemId === item.id);
                if (bids.length > 0) {
                    currentBid = Math.max(...bids.map(b => b.amount));
                }
            }

            const content = document.getElementById('item-content');
            content.innerHTML = `
                <div class="item-gallery">
                    <div class="gallery-main" id="gallery-main">
                        <img src="${item.cover}" alt="${item.title}" width="800" height="800" id="main-image">
                        <button class="gallery-fullscreen" onclick="window.UI.openLightbox(${JSON.stringify(item.images)}, 0)" aria-label="View fullscreen">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M2 8V2h6M18 12v6h-6M2 2l6 6M18 18l-6-6"/>
                            </svg>
                        </button>
                    </div>
                    <div class="gallery-thumbs" id="gallery-thumbs">
                        ${item.images.map((img, idx) => `
                            <button class="gallery-thumb ${idx === 0 ? 'active' : ''}" onclick="changeImage('${img}', ${idx})">
                                <img src="${img}" alt="${item.title} - Image ${idx + 1}" width="100" height="100">
                            </button>
                        `).join('')}
                    </div>
                </div>

                <div class="item-info-panel">
                    <div class="item-header">
                        <div>
                            <h1 class="item-brand-title">${item.brand}</h1>
                            <h2 class="item-model-title">${item.title}</h2>
                        </div>
                        <button class="watchlist-btn-large ${isWatched ? 'active' : ''}" onclick="toggleWatchlist()" aria-label="${isWatched ? 'Remove from watchlist' : 'Add to watchlist'}">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="${isWatched ? '#d4af37' : 'none'}" stroke="currentColor" stroke-width="2">
                                <path d="M12 4l3 6 6.5.5-5 5 1.5 7-6-3.5-6 3.5 1.5-7-5-5 6.5-.5z"/>
                            </svg>
                        </button>
                    </div>

                    <div class="item-pricing-section">
                        ${item.status === 'auction' ? `
                            <div class="auction-info-panel">
                                <div class="current-bid-display">
                                    <span class="bid-label">Current Bid</span>
                                    <span class="bid-amount">${window.Render.currency(currentBid)}</span>
                                </div>
                                <div class="auction-countdown-display">
                                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="9" cy="9" r="7"/>
                                        <path d="M9 5v4l3 2"/>
                                    </svg>
                                    <span id="countdown">${window.Render.timeRemaining(item.endsAtISO)}</span>
                                </div>
                                <button class="btn-primary large full-width" onclick="openBidModal()">Place Bid</button>
                            </div>
                        ` : item.status === 'available' ? `
                            <div class="price-display">
                                <span class="price-label">Price</span>
                                <span class="price-amount">${window.Render.currency(item.price)}</span>
                            </div>
                            <button class="btn-primary large full-width" onclick="expressInterest()">Express Interest</button>
                        ` : `
                            <div class="appointment-display">
                                <span class="price-amount">${window.Render.currency(item.price)}</span>
                                <span class="appointment-label">By Appointment Only</span>
                            </div>
                            <button class="btn-primary large full-width" onclick="requestAppointment()">Request Private Viewing</button>
                        `}
                    </div>

                    <div class="item-details-tabs">
                        <div class="tabs-header" role="tablist">
                            <button class="tab-button active" role="tab" data-tab="description" aria-selected="true">Description</button>
                            <button class="tab-button" role="tab" data-tab="details">Details</button>
                            <button class="tab-button" role="tab" data-tab="authenticity">Authenticity</button>
                        </div>
                        <div class="tabs-content">
                            <div class="tab-panel active" id="tab-description" role="tabpanel">
                                <p>${item.description}</p>
                                <div class="item-tags">
                                    ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                </div>
                            </div>
                            <div class="tab-panel" id="tab-details" role="tabpanel">
                                <dl class="details-list">
                                    <dt>Brand</dt>
                                    <dd>${item.brand}</dd>
                                    <dt>Model</dt>
                                    <dd>${item.model}</dd>
                                    <dt>Year</dt>
                                    <dd>${item.year}</dd>
                                    <dt>Condition</dt>
                                    <dd>${item.condition}</dd>
                                    <dt>Measurements</dt>
                                    <dd>${item.measurements}</dd>
                                    <dt>Category</dt>
                                    <dd>${item.category}</dd>
                                </dl>
                            </div>
                            <div class="tab-panel" id="tab-authenticity" role="tabpanel">
                                <div class="authenticity-badge">
                                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" stroke="#d4af37" stroke-width="2">
                                        <path d="M24 4l4 8 8 4-8 4-4 8-4-8-8-4 8-4z"/>
                                        <circle cx="24" cy="24" r="20"/>
                                    </svg>
                                    <h3>100% Authenticated</h3>
                                </div>
                                <p>${item.authenticity}</p>
                                <p class="authenticity-note">Every item is rigorously authenticated by our team of luxury specialists before listing.</p>
                            </div>
                        </div>
                    </div>

                    <div class="item-metrics">
                        <div class="metric">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="8" cy="8" r="3"/>
                                <path d="M1 8s3-5 7-5 7 5 7 5-3 5-7 5-7-5-7-5z"/>
                            </svg>
                            <span>${item.metrics.views} views</span>
                        </div>
                        <div class="metric">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 2l2 4 4.5.5-3.5 3.5 1 4.5-4-2.5-4 2.5 1-4.5-3.5-3.5 4.5-.5z"/>
                            </svg>
                            <span>${item.metrics.watchers} watchers</span>
                        </div>
                    </div>
                </div>
            `;

            // Setup tabs
            window.UI.initTabs(document.querySelector('.item-details-tabs'));

            // Change image function
            window.changeImage = function(src, idx) {
                document.getElementById('main-image').src = src;
                document.querySelectorAll('.gallery-thumb').forEach((thumb, i) => {
                    thumb.classList.toggle('active', i === idx);
                });
            };

            // Toggle watchlist
            window.toggleWatchlist = function() {
                window.DataService.toggleWatchlist(item.id);
                const isNowWatched = window.DataService.getWatchlist().includes(item.id);
                const btn = document.querySelector('.watchlist-btn-large');
                btn.classList.toggle('active', isNowWatched);
                btn.querySelector('path').setAttribute('fill', isNowWatched ? '#d4af37' : 'none');
                window.UI.toast(isNowWatched ? 'Added to watchlist' : 'Removed from watchlist', 'success');
            };

            // Bid modal for auctions
            window.openBidModal = function() {
                const modal = document.createElement('div');
                modal.id = 'item-bid-modal';
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>Place Your Bid</h2>
                            <button class="modal-close" onclick="window.UI.closeModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="item-bid-form">
                                <div class="form-group">
                                    <label for="bid-amount">Bid Amount (USD)</label>
                                    <input type="number" id="bid-amount" name="amount" min="${currentBid + 50}" step="50" required class="form-control">
                                    <p class="form-hint">Current bid: ${window.Render.currency(currentBid)}</p>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="terms" required>
                                        <span>I agree to the auction terms and conditions</span>
                                    </label>
                                </div>
                                <div class="modal-actions">
                                    <button type="button" class="btn-secondary" onclick="window.UI.closeModal()">Cancel</button>
                                    <button type="submit" class="btn-primary">Place Bid</button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                window.UI.setupFocusTrap(modal.querySelector('.modal-content'));

                window.Forms.setup('#item-bid-form', {
                    successMessage: 'Bid placed successfully!',
                    onSuccess: async (formData) => {
                        await window.Forms.submitBid(item.id, parseInt(formData.amount), item.title, item.brand);
                        document.body.removeChild(modal);
                        setTimeout(() => window.location.href = '../auctions/index.html', 1500);
                    }
                });
            };

            // Express interest
            window.expressInterest = function() {
                window.location.href = `../support/contact.html?item=${item.id}`;
            };

            // Request appointment
            window.requestAppointment = function() {
                window.location.href = `../support/contact.html?item=${item.id}&type=appointment`;
            };

            // Update countdown for auctions
            if (item.status === 'auction') {
                setInterval(() => {
                    const countdown = document.getElementById('countdown');
                    if (countdown) {
                        countdown.textContent = window.Render.timeRemaining(item.endsAtISO);
                    }
                }, 1000);
            }
        })();
    </script>
</body>
</html>
