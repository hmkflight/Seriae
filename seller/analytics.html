<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Analytics - SERIAE</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;500;600;700&family=Inter:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <script src="../assets/js/translations.js"></script>
</head>
<body>
    <a href="#main-content" class="skip-to-content" data-translate="accessibility.skip">Skip to content</a>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="../index.html"><h1>SERIAE</h1></a>
            </div>
            <div class="nav-links">
                <div class="nav-dropdown">
                    <a href="../dashboard.html" class="nav-link" data-translate="nav.dashboard">Dashboard</a>
                </div>
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-trigger"><span data-translate="nav.buyer.menu">Buyer Menu</span> <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu">
                        <a href="../collections/index.html" class="dropdown-item" data-translate="buyer.browse.collections">Browse Collections</a>
                        <a href="../auctions/index.html" class="dropdown-item" data-translate="buyer.active.auctions">Active Auctions</a>
                        <a href="../auctions/history.html" class="dropdown-item" data-translate="buyer.bidding.history">Bidding History</a>
                        <a href="../watchlist/index.html" class="dropdown-item" data-translate="buyer.watchlist">Watchlist</a>
                        <a href="../purchases/index.html" class="dropdown-item" data-translate="buyer.purchase.history">Purchase History</a>
                    </div>
                </div>
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-trigger"><span data-translate="nav.seller.menu">Seller Menu</span> <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu">
                        <a href="../seller/register.html" class="dropdown-item" data-translate="seller.product.registration">Product Registration</a>
                        <a href="../seller/products.html" class="dropdown-item" data-translate="seller.product.list">Product List</a>
                        <a href="../seller/exhibitions.html" class="dropdown-item" data-translate="seller.exhibition.list">Exhibition List</a>
                        <a href="../seller/analytics.html" class="dropdown-item" aria-current="page" data-translate="seller.sales.analytics">Sales Analytics</a>
                        <a href="../seller/consignment.html" class="dropdown-item" data-translate="seller.consignment.status">Consignment Status</a>
                    </div>
                </div>
                <div class="nav-dropdown">
                    <a href="#" class="nav-link dropdown-trigger"><span data-translate="nav.user.management">User Management</span> <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu">
                        <a href="../legal/terms.html" class="dropdown-item" data-translate="user.terms.of.use">Terms of Use</a>
                        <a href="../support/contact.html" class="dropdown-item" data-translate="user.contact.us">Contact Us</a>
                        <a href="../support/index.html" class="dropdown-item" data-translate="user.support.center">Support Center</a>
                        <a href="../legal/privacy.html" class="dropdown-item" data-translate="user.privacy.policy">Privacy Policy</a>
                    </div>
                </div>
            </div>
            <div class="nav-actions">
                <div class="nav-dropdown language-toggle">
                    <a href="#" class="nav-link dropdown-trigger">EN <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu">
                        <a href="#" class="dropdown-item" data-lang="en" data-translate="common.english">English</a>
                        <a href="#" class="dropdown-item" data-lang="ja" data-translate="common.japanese">日本語</a>
                    </div>
                </div>
                <div class="nav-dropdown profile-menu">
                    <a href="#" class="nav-link dropdown-trigger profile-trigger"><span data-translate="nav.profile">Profile</span> <span class="dropdown-arrow">▼</span></a>
                    <div class="dropdown-menu profile-dropdown">
                        <div class="profile-header">
                            <div class="profile-avatar">S</div>
                            <div class="profile-info">
                                <span class="profile-name" data-translate="profile.member.name">Seriae Member</span>
                                <span class="profile-status" data-translate="profile.member.status">Premium</span>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="../account/profile.html" class="dropdown-item" data-translate="profile.my.profile">My Profile</a>
                        <a href="../account/settings.html" class="dropdown-item" data-translate="profile.account.settings">Account Settings</a>
                        <a href="../account/addresses.html" class="dropdown-item" data-translate="profile.shipping.address">Shipping Address</a>
                        <a href="../account/payment.html" class="dropdown-item" data-translate="profile.bank.accounts">Bank Accounts</a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item logout" data-translate="nav.logout">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main id="main-content">
        <section class="page-header">
            <div class="container">
                <div class="page-header-content">
                    <div>
                        <h1 data-translate="seller.analytics.title">Sales Analytics</h1>
                        <p data-translate="seller.analytics.subtitle">Track your performance and earnings</p>
                    </div>
                    <select id="period-filter" class="form-control" style="width: auto;">
                        <option value="all">All Time</option>
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                        <option value="365">Last Year</option>
                    </select>
                </div>
            </div>
        </section>

        <section class="analytics-overview">
            <div class="container">
                <div class="stats-grid large">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 4v24M8 12v12M24 8v16"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number" id="total-sales">$0</span>
                            <span class="stat-label" data-translate="seller.analytics.total.sales">Total Sales</span>
                            <span class="stat-change positive" id="sales-change">+0%</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M28 12L16 4 4 12v16h24V12z"/>
                                <path d="M12 28V16h8v12"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number" id="items-sold">0</span>
                            <span class="stat-label" data-translate="seller.analytics.items.sold">Items Sold</span>
                            <span class="stat-change positive" id="items-change">+0</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="16" cy="16" r="12"/>
                                <path d="M12 16l4 4 8-8"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number" id="conversion-rate">0%</span>
                            <span class="stat-label" data-translate="seller.analytics.conversion">Conversion Rate</span>
                            <span class="stat-change positive" id="conversion-change">+0%</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="16" cy="8" r="4"/>
                                <path d="M8 28v-4a8 8 0 0116 0v4"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <span class="stat-number" id="avg-days">0</span>
                            <span class="stat-label" data-translate="seller.analytics.avg.days">Avg. Days to Sell</span>
                            <span class="stat-change positive" id="days-change">-0</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="analytics-charts">
            <div class="container">
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3 data-translate="seller.analytics.chart.performance">Performance by Category</h3>
                        <div id="category-chart" class="chart-content">
                            <!-- Chart will be rendered here -->
                        </div>
                    </div>

                    <div class="chart-card">
                        <h3 data-translate="seller.analytics.chart.top">Top Performing Items</h3>
                        <div id="top-items" class="top-items-list">
                            <!-- Top items will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="analytics-table">
            <div class="container">
                <h2 data-translate="seller.analytics.recent.sales">Recent Sales</h2>
                <div id="sales-table" class="table-container">
                    <!-- Sales table will be rendered here -->
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>SERIAE</h3>
                <p data-translate="footer.tagline">Curating excellence in luxury resale since 1987</p>
            </div>
            <div class="footer-section">
                <h4 data-translate="footer.collections">Collections</h4>
                <ul>
                    <li><a href="../collections/index.html" data-translate="footer.handbags.accessories">Handbags & Accessories</a></li>
                    <li><a href="../collections/index.html" data-translate="footer.fine.timepieces">Fine Timepieces</a></li>
                    <li><a href="../seller/register.html" data-translate="footer.private.consignment">Private Consignment</a></li>
                    <li><a href="../support/index.html" data-translate="footer.authentication.services">Authentication Services</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4 data-translate="footer.experience">Experience</h4>
                <ul>
                    <li><a href="../support/index.html" data-translate="footer.private.showroom">Private Showroom</a></li>
                    <li><a href="../support/contact.html" data-translate="footer.personal.curator">Personal Curator</a></li>
                    <li><a href="../account/profile.html" data-translate="footer.member.services">Member Services</a></li>
                    <li><a href="../support/index.html" data-translate="footer.heritage.stories">Heritage Stories</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p data-translate="footer.copyright">&copy; 2024 Seriae. All rights reserved. | London | New York | Geneva</p>
        </div>
    </footer>

    <script src="../assets/js/data.js"></script>
    <script src="../assets/js/ui.js"></script>
    <script src="../assets/js/render.js"></script>
    <script src="../assets/js/main.js"></script>
    <script>
        // Sales analytics page logic
        (async function() {
            const consignmentsData = await window.DataService.getConsignments();
            const soldItems = consignmentsData.consignments.filter(c => c.status === 'Sold');

            function calculateAnalytics() {
                // Total sales
                const totalSales = soldItems.reduce((sum, item) => sum + (item.soldPrice || item.price), 0);
                const commission = 0.15; // 15% default
                const totalEarnings = totalSales * (1 - commission);

                // Items sold
                const itemsSold = soldItems.length;

                // Conversion rate
                const totalListings = consignmentsData.consignments.filter(c => c.status === 'Listed' || c.status === 'Sold').length;
                const conversionRate = totalListings > 0 ? ((itemsSold / totalListings) * 100).toFixed(1) : 0;

                // Average days to sell
                const daysToSell = soldItems.map(item => {
                    if (!item.listedAt || !item.soldAt) return 0;
                    const listed = new Date(item.listedAt);
                    const sold = new Date(item.soldAt);
                    return Math.floor((sold - listed) / (1000 * 60 * 60 * 24));
                }).filter(days => days > 0);
                const avgDays = daysToSell.length > 0 ? Math.round(daysToSell.reduce((sum, d) => sum + d, 0) / daysToSell.length) : 0;

                // Update UI
                document.getElementById('total-sales').textContent = window.Render.currency(totalEarnings);
                document.getElementById('items-sold').textContent = itemsSold;
                document.getElementById('conversion-rate').textContent = `${conversionRate}%`;
                document.getElementById('avg-days').textContent = avgDays;

                // Mock changes
                document.getElementById('sales-change').textContent = '+12.5%';
                document.getElementById('items-change').textContent = `+${itemsSold}`;
                document.getElementById('conversion-change').textContent = '+3.2%';
                document.getElementById('days-change').textContent = '-2';
            }

            function renderCategoryChart() {
                const chart = document.getElementById('category-chart');

                // Group by category
                const byCategory = soldItems.reduce((acc, item) => {
                    acc[item.category] = (acc[item.category] || 0) + (item.soldPrice || item.price);
                    return acc;
                }, {});

                const maxValue = Math.max(...Object.values(byCategory));

                chart.innerHTML = Object.entries(byCategory).map(([category, value]) => {
                    const percentage = (value / maxValue * 100).toFixed(1);
                    return `
                        <div class="chart-bar-row">
                            <span class="chart-label">${category}</span>
                            <div class="chart-bar">
                                <div class="chart-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                            <span class="chart-value">${window.Render.currency(value)}</span>
                        </div>
                    `;
                }).join('');
            }

            function renderTopItems() {
                const topItems = document.getElementById('top-items');

                const sortedItems = [...soldItems]
                    .sort((a, b) => (b.soldPrice || b.price) - (a.soldPrice || a.price))
                    .slice(0, 5);

                if (sortedItems.length === 0) {
                    topItems.innerHTML = '<p class="no-data">No sales yet</p>';
                    return;
                }

                topItems.innerHTML = sortedItems.map((item, index) => `
                    <div class="top-item">
                        <span class="item-rank">${index + 1}</span>
                        <div class="item-info">
                            <strong>${item.brand} ${item.model}</strong>
                            <span>${item.category}</span>
                        </div>
                        <span class="item-value">${window.Render.currency(item.soldPrice || item.price)}</span>
                    </div>
                `).join('');
            }

            function renderSalesTable() {
                const table = document.getElementById('sales-table');

                if (soldItems.length === 0) {
                    table.innerHTML = '<p class="no-data">No sales yet</p>';
                    return;
                }

                const recentSales = [...soldItems]
                    .sort((a, b) => new Date(b.soldAt) - new Date(a.soldAt))
                    .slice(0, 10);

                table.innerHTML = `
                    <table class="sales-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Category</th>
                                <th>Sold Date</th>
                                <th>Sale Price</th>
                                <th>Commission</th>
                                <th>Your Earnings</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recentSales.map(item => {
                                const salePrice = item.soldPrice || item.price;
                                const commission = salePrice * 0.15;
                                const earnings = salePrice - commission;
                                return `
                                    <tr>
                                        <td>
                                            <div class="product-cell">
                                                <strong>${item.brand}</strong>
                                                <span>${item.model}</span>
                                            </div>
                                        </td>
                                        <td>${item.category}</td>
                                        <td>${window.Render.formatDate(item.soldAt)}</td>
                                        <td>${window.Render.currency(salePrice)}</td>
                                        <td>${window.Render.currency(commission)}</td>
                                        <td><strong>${window.Render.currency(earnings)}</strong></td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                `;
            }

            // Initial render
            calculateAnalytics();
            renderCategoryChart();
            renderTopItems();
            renderSalesTable();
        })();
    </script>
</body>
</html>
